include:
  - docassemble.mlhframework:mlh_interview_framework.yml
  - SnapCalculator-parameters.yml
  - SnapCalculator-questions.yml
  - SnapCalculator-calculation.yml

---
# docassemble-level metadata
# See https://docassemble.org/docs/initial.html
metadata:
  title: Food Stamp (FAP) Calculator
  short title: Food Stamp Calculator
  description: |
    Use this calculator to help you find out if you are eligible to get Food Stamps (FAP)
  #exit url: https://www.masslegalservices.org/content/online-snap-calculator
  show login: False
  tags: []
  authors:
    - Brett Harrison of Maverick & Mitchell LLC
  help_page_url: https://michiganlegalhelp.org/resources/public-assistance/food-stamps-fap
  help_page_title: Food Stamps (FAP)
  #allowed_courts: []
  #typical_role: "unknown"

---
modules:
  - docassemble.base.core
---
id: interview config code block
initial: True
code: |
  github_repo_name = 'docassemble-MichiganFoodStampCalculator' if get_config('debug') else 'docassemble-UserFeedback'
  MLH_instructions_included = False
  MLH_materials_included = False
  MLH_court_forms = False
  MLH_esign_supported = False
  MLH_form_type = "food stamp estimate"
  MLH_time_min = 5
  MLH_time_max = 10
---
code: |
  resource_page_url_only = "https://michiganlegalhelp.org/resources/public-assistance/food-stamps-fap"
  resource_page_name = "Food Stamps (FAP)"
  survey_link_url_only = "https://www.surveymonkey.com/r/SGV8XSK"
---
template: survey_embed_script
content: |
  <script>
    (function(t,e,s,n){var o,a,c;t.SMCX=t.SMCX||[],e.getElementById(n)||(o=e.getElementsByTagName(s),a=o[o.length-1],c=e.createElement(s),c.type="text/javascript",c.async=!0,c.id=n,c.src="https://widget.surveymonkey.com/collect/website/js/tRaiETqnLgj758hTBazgdzxwuSQVZA5gS55pIr4pOSbBe0e24oUEB64wCHRpX8sy.js",a.parentNode.insertBefore(c,a))})(window,document,"script","smcx-sdk");
  </script>

---
###################### Main order ######################
mandatory: true
code: |
  snapshot_start
  #Intro pages
  MLH_intro_landing
  MLH_agree_terms
  MLH_intro_navigate_save
  household_and_eligibility
  set_progress(50)

  #Question screen
  HHSize
  ineligble_members
  
  set_progress(100)
  snapshot_download
  finalScreen
  
  #saving answers???
  #recommend this resource???
  
---
# overrides framework question.
# This can be used as the very first screen for an interview.
id: MLH intro landing FirstScreen
question: |
  ${ MLH_interview_short_title }
subquestion: |
  ${ MLH_welcome_message }
  
  It will probably take about **${ MLH_time_min } to ${ MLH_time_max } minutes** to answer all the questions.
continue button field: MLH_intro_landing

---
# default welcome info; keep relatively short. If lots of preconditions/warnings, make separate screen
template: MLH_welcome_message     
content: |
  Welcome to the ${ MLH_interview_short_title } tool.

  Use this calculator to help determine if you are eligible to get Food Stamps. This calculator will ask questions about your income and household. 
  
  After you answer all the questions, you will get a Food Stamps Summary printout. This will tell you if your household is eligible for Food Stamps and give you an **estimated** benefit amount. There is **no** guarantee you will receive this amount.

---
# overrides framework question.
if: user_logged_in()
id: MLH intro saving answers logged in
question: |
  Using this tool
subquestion: |
  <h2 class="h5">Changing an Answer</h2>
  Tap the **${ MLH_back_button_label }** button below to go back to the previous page.
  
  <h2 class="h5">Saving Your Work</h2>
  You are already signed in. Just tap the **${MLH_continue_button_label}** button to save your progress. 
  
  Go to the menu at the top of the screen and select “My Forms” to go back to a saved calculation.
  
  <h2 class="h5">Help Text</h2>
  Tap {green underlined words} for a definition or more information.   
terms:
  green underlined words: |
    More information appears when you tap the green underlined words.
continue button field: MLH_intro_navigate_save
---
# overrides framework question of the same name. 
if: not user_logged_in()
id: MLH intro saving answers logged out
question: |
  Using this tool
subquestion: |
  <h2 class="h5">Changing an Answer</h2>
  Tap the **${ MLH_back_button_label }** button below to go back to the previous page.
  
  <h2 class="h5">Saving Your Work</h2>
  To save your work, sign in or sign up for an account. Tap the "Sign in" or "Sign up" link below the **Continue** button. Or go to the
  % if device().is_mobile:
  :bars:
  % endif
  **menu** at the top of the screen and tap "Sign in or sign up to save answers".
  
  To go back to a saved form, log in. Then go to the menu at the top of the screen and select “My Forms.”
  
  <h2 class="h5">Help Text</h2>
  Tap {green underlined words} for a definition or more information. 
terms:
  green underlined words: |
    More information appears when you tap the green underlined words.
continue button field: MLH_intro_navigate_save

---
id: household and eligibility
question: |
  Household Information and Eligibility
subquestion: |
  According to food stamp rules, your **entire household** includes everyone who:
  
  * lives with you, and 
  * regularly buys and prepares food together. 

  **Plus**, the following people are always included if they live with you (even if you don’t buy and prepare food together):
  
  * your spouse,
  * your children under age 22, and 
  * your other dependents under age 18 (for example: a niece or grandchild you care for, or a foster child)

  
  ${ prog_disclose(ineligible_household_member) }
continue button field: household_and_eligibility

---
id: DownloadScreen
event: finalScreen
comment: |
  Display the major results on the screen, and let the user choose what to download.  
question: |
subquestion: |
  % if no_eligible_members:

  ###Based on your answers, nobody in your household is eligible to receive food stamps. 
  
  Tap **${ MLH_back_button_label }** to go back and change your answers if you think this was a mistake.

  Visit [An Overview of the Food Assistance Program (FAP, Food Stamps)](https://michiganlegalhelp.org/resources/public-assistance/overview-of-food-assistance-program-fap-or-food-stamps) on MichiganLegalHelp.org to learn more about the FAP program and eligibility. You may be eligible for [additional food assistance resources](https://www.michigan.gov/mdhhs/assistance-programs/food).

  % elif FinalResult <= 0:
  
  ###You do not seem to be eligible for FAP  benefits. 
  
  Visit [An Overview of the Food Assistance Program (FAP, Food Stamps)](https://michiganlegalhelp.org/resources/public-assistance/overview-of-food-assistance-program-fap-or-food-stamps) on MichiganLegalHelp.org to learn more about the FAP program and eligibility. You may be eligible for [additional food assistance resources](https://www.michigan.gov/mdhhs/assistance-programs/food).

  You can user the ${ MLH_back_button_label } button to revise your input, or restart a new interview. 
  % else:
  ###You may be eligible for FAP benefits.
  
  #####If you apply and are approved, your benefit may be <span style="color: green">${ currency(FinalResult) }</span> per month.<br>
  % endif

  %if no_eligible_members == False:
  #####You can download or email a summary and detailed calculation below. 
    
  ${ AssetTestScreenMsg }

  ${ al_user_bundle.download_list_html() }

  ${ al_user_bundle.send_button_html(show_editable_checkbox=False) }
  % endif

  <h2 class="h3">Take our quick survey!</h2>
  Answer below or [open the survey in a new tab](${ survey_link_url_only }).
  ${ survey_embed_script }
buttons: 
  - Exit: exit
  - Restart: restart

---
# Bundles group the ALDocuments into separate downloads, such as for court and for the user
objects:
  - al_user_bundle: >-
      ALDocumentBundle.using(elements=[FAP_Calculator_Results],
      filename="fee_waiver_request_packet", title="All forms and instructions",
      enabled=True)
---
# ALDocument objects specify the metadata for each template
objects:
  - FAP_Calculator_Results: >-
      ALDocument.using(title="FAP Calculator Results", 
      filename="FAP Calculator Results", enabled=True, has_addendum=False,
      default_overflow_message=AL_DEFAULT_OVERFLOW_MESSAGE)
---
attachment:
  name: FAP Results 
  filename: FAP_Calculator_Results_file
  variable name: FAP_Calculator_Results[i]
  docx template file: 'snap-summary.docx'
  skip undefined: False
  tagged pdf: True

---
code: |
  stuff_to_snapshot['zip'] = ''
  stuff_to_snapshot['number_of_forms'] = 1
  stuff_to_snapshot['end_time'] = str(current_datetime().format_datetime(format='yyyy-MM-dd h:mm a'))
  if snapshot_dv_question == True:
    stuff_to_snapshot['dv_present'] = showifdef('snapshot_dv_present')
  reconsider('snapshot_interview_state')
  snapshot_download = True
